---
layout: post
title: RS-232串行通讯笔记
date: 2017-07-25
categories: blog
tags: [串口通讯]
description: 
---



## 1. 电气特性

- TxD 和 RxD 上：	逻辑 1 (MARK) = - 3V ~ -15V

  ​				逻辑  0 (SPACE) = +3V ~ +15V

- RTS、CTS、DSR、DTR 和 DCD 等控制在线：

  信号有效（接通，ON状态，正电压） = +3V ~ +15V

  信号无效（断开，OFF状态，负电压）= -3V ~ -15V

> 即：当传输电平的绝对值大于 3V 事，电路可以有效地检查出来，介于 -3 ~ +3V 之间的电压无意义，低于 -15V 或高于 +15V 的电压也认为无意义。
>
> 因此，实际工作时，应保证电平在 ±(3~15)V 之间

## 2. 连机器的机械特性

以 DB-9 为主

![DB25及DB9接口引脚定义](http://otnjt3h06.bkt.clouddn.com/image/DB25andDB9.png)

- 线缆长度：在通讯速率低于 20kb/s 时， RS-232 所直接连接的最大物理距离为 15m
- 最大直接传输距离说明：RS-232C标准规定，若不使用MODEM，在码元畸变小于4%的情况下，DTE和DCE之间最大传输距离为15m（50英尺）。可见这个最大的距离是在码元畸变小于4%的前提下给出的。为了保证码元畸变小于4%的要求，接口标准在电气特性中规定，驱动器的负载电容应小于2500pF。

## 3. RS-232 接口信号

> 缩写词解释：
>
> DTE------Data Terminal Equipment,数据终端设备
>
> DCE------Data Communication Equipment，数据通讯设备
>
> EIA------Electronic Industry Association，美国电子工业协会
>
> RS------recommended standard，推荐标准

1. 联络控制信号线

   - 数据装置准备好（Data set ready-DSR)——有效时（ON）状态，表明MODEM处于可以使用的状态
   - 数据终端准备好(Data set ready-DTR)——有效时（ON）状态，表明数据终端可以使用。

   > 这两个信号有时连到电源上，一上电就立即有效。这两个设备状态信号有效，只表示设备本身可用，并不说明通信链路可以开始进行通信了，能否开始进行通信要由下面的控制信号决定。

   - 请求发送(Request to send-RTS)——用来表示DTE请求DCE发送数据，即当终端要发送数据时，使该信号有效（ON状态），向MODEM请求发送。它用来控制MODEM是否要进入发送状态。
   - 允许发送（Clear to send-CTS）——用来表示DCE准备好接收DTE发来的数据，是对请求发送信号RTS的响应信号。当MODEM已准备好接收终端传来的数据，并向前发送时，使该信号有效，通知终端开始沿发送数据线TxD发送数据。

   > 这对RTS/CTS请求应答联络信号是用于半双工MODEM系统中发送方式和接收方式之间的切换。在全双工系统中作发送方式和接收方式之间的切换。在全双工系统中，因配置双向信道，故不需要RTS/CTS联络信号，使其变高。

   - 接收线信号检出(Received Line detection-RLSD)——用来表示DCE已接通通信链路，告知DTE准备接收数据。当本地的MODEM收到由通信链路另一端（远地）的MODEM送来的载波信号时，使RLSD信号有效，通知终端准备接收，并且由MODEM将接收下来的载波信号解调成数字两数据后，沿接收数据线RxD送到终端。此线也叫做数据载波检出(Data Carrier dectection-DCD）线。
   - 振铃指示(Ringing-RI)——当MODEM收到交换台送来的振铃呼叫信号时，使该信号有效（ON状态），通知终端，已被呼叫。

2. 数据发送与接收线

   - 发送数据(Transmitted
     data-TxD)——通过TxD终端将串行数据发送到MODEM，(DTE→DCE)。
   - 接收数据(Received data-RxD)——通过RxD线终端接收从MODEM发来的串行数据，(DCE→DTE)

3. 地线

   - SG------信号地
   - PG------保护地

   > 无方向

## 4. 近距离通信

> 不需要 RS-232 控制联络信号，只需三根线（发送线TxD，接收线RxD，信号地线SG）

### 最大通讯距离：

- RS-232C标准规定：当误码率小于4%时，要求导线的电容值应小于2500PF。对于普通导线，其电容值约为170PF/M。则允许距离L=2500PF/（170PF/M）=15M 
- 实际应用中，当使用9600bps，普通双绞屏蔽线时，距离可达30~35米

### 1. 最简联机（三线制）

![RS232三线制通信接线](http://otnjt3h06.bkt.clouddn.com/image\RS232三线制通信.png)

图中的**2号线与3号线交叉连接**是因为在直连方式时，把通信双方都当作数据终端设备看待，双方都可发也可收。在这种方式下，通信双方的任何一方，只要请求发送RTS有效和数据终端准备好DTR有效就能开始发送和接收。 

1. RTS与CTS互联：只要请求发送，立即得到允许 
2. DTR与DSR互联：只要本端准备好，认为本端立即可以接收（DSR、数传机准备好）。 

### 2. 标准连接

![RS232近距离标准连接1](http://otnjt3h06.bkt.clouddn.com/image\RS232标准连接.jpg)

从中可以看出，RS-232 接口标准定义的所有信号线都用到了，并且是按照DTE和DCE之间信息交换协议的要求进行连接的，只不过是把DTE自己发出的信号线送过来，当作对方DCE发来的信号，因此，又把这种连接称为**双叉环回接口**。 

1. 当甲方的DTE准备好，发出DTR信号，该信号直接联至乙方的RI（振铃信号）和DSR（数传机准备好）。即只要甲方准备好，乙方立即产生呼叫（RI）有效，并同时准备好（DSR）。尽管此时乙方并不存在DCE（数传机）。
2. 甲方的RTS和CTS相连，并与乙方的DCD互连。即：一旦甲方请求发送（RTS），便立即得到允许（CTS），同时，使乙方的DCD有效，即检测到载波信号。 
3. 甲方的TXD与乙方的RXD相连，一发一收。 

![RS232标准连接2](http://otnjt3h06.bkt.clouddn.com/image\RS232标准连接2.jpg)

![RS232标准连接3](http://otnjt3h06.bkt.clouddn.com/image\RS232标准连接3.jpg)

![RS232标准连接4](http://otnjt3h06.bkt.clouddn.com/image\RS232标准连接4.jpg)

![RS232标准连接5](http://otnjt3h06.bkt.clouddn.com/image\RS232标准连接5.jpg)

## 5. 串行通讯控制理论

### 1. 通讯种类及比较

1. 并行传输：一次传输量为 8 个位（一个字节）。易受电压衰减、信号干扰，从而使得传输数据发生错误

   ![并行传输](http://otnjt3h06.bkt.clouddn.com/image\并行传输.png)

2. 串行传输：一次传输量 为 1 个位。数据不易漏失，加上一些防范措施后更不易漏失。

   ![串行传输](http://otnjt3h06.bkt.clouddn.com/image\串行传输.png)

### 2. RS-232 通讯

同步通讯的两端使用同步讯号作为通讯的依据；异步通讯使用起始位（Start Bit）及停止位（Stop Bit)作为通讯的判断，现在则是以使用异步通讯较多。异步传输只要 9 脚就够了；同步传输则需使用到 25 脚。

### 1. 数据的传送单位

串行通讯端口所传送的数据是字符形态，工业使用 ASCII字符码及 JIS 字符码。ASCII 码 8 个位形成一个字符，JIS 码 7 个位形成一个字符。

### 2. 起始位及停止位

当双发要开始传输数据时， **发送端**会在所送出的字符前加上低电位的起始位，在字符后加上高电位的停止位， **接收端**会依起始位及停止位的设定确实地接收到字符；当加入了起始位及停止位也能比较容易达到多字符的接收能力。

起始位固定为 1 个位，而停止位则有 1 、 1.5 、 2 个为等多种选择，只要通讯双方协议通过即可。

### 3. 校验位

分为**偶校验（Even Parity）** 与 **奇校验（Odd Parity）** ，分别检查字符码中 1 的数目是奇数或偶数,校验位可以不使用。

- 偶校验：被校验字符含有偶数个 1 时，校验位为 0 ，反之为 1
- 奇校验：被校验字符含有奇数个 1 时，校验位为 0 ，反之为 1

### 4. 串行通讯数据格式

> 起始位 + 传送字符 + 校验位 + 停止位
>
> Start Bits + Data Bits + Parity + Stop Bits






